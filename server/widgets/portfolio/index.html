<!--
  IMPORTANT: All IDs, variable names, and function names in this widget must use camelCase.
  This ensures consistency between HTML and JavaScript, and avoids mismatches.
  Do NOT use dash-case (e.g. add-position-btn) for IDs in widget code.
-->
<div class="mb-8 max-w-[85rem] mx-auto w-full flex flex-col gap-6">
    <!-- Add Position Toolbar -->
    <div class="bg-slate-800 rounded-xl shadow p-6 flex justify-end gap-4">
        <button id="addPositionBtn" class="primary-btn py-2 px-4 rounded-lg text-white bg-blue-600 hover:bg-blue-700 flex items-center gap-2">
            <i class="fa-solid fa-plus"></i> Add Position
        </button>
        <button id="settingsBtn" class="text-slate-400 hover:text-blue-400 focus:outline-none flex items-center justify-center rounded-full h-10 w-10" title="Portfolio Settings">
            <i class="fa-solid fa-gear text-xl"></i>
        </button>
    </div>
    <!-- Portfolio Card -->
    <div class="bg-slate-800 rounded-xl shadow-sm p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-bold text-white flex items-center gap-2">
                Portfolio
            </h2>
        </div>
        <div class="overflow-x-auto mb-4">
            <table class="min-w-full divide-y divide-slate-700" id="positionsTable">
                <thead>
                    <tr>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-300 uppercase">Symbol</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-300 uppercase">Quantity</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-300 uppercase">Buy Price</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-300 uppercase">Buy Date</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-300 uppercase">% of Portfolio</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-300 uppercase">Beta</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-300 uppercase">Delta</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-300 uppercase">Notes</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-300 uppercase">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-700" id="positionsTbody">
                    <tr><td colspan="9" class="text-center text-gray-400 py-4">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    <!-- Add/Edit Modal (hidden by default) -->
    <div id="positionModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 hidden">
        <div class="bg-slate-800 rounded-lg shadow-lg w-full max-w-md p-6">
            <h3 class="text-xl font-bold text-white mb-4" id="modalTitle">Add Position</h3>
            <form id="positionForm" class="space-y-4">
                <input type="hidden" id="positionId">
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="symbol">Symbol</label>
                    <input type="text" id="symbol" class="w-full p-2 rounded bg-slate-700 text-white" required autocomplete="off" style="text-transform:uppercase; letter-spacing:0.5px;">
                    <div id="symbolDropdown" class="relative"></div>
                </div>
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="quantity">Quantity</label>
                    <input type="number" id="quantity" class="w-full p-2 rounded bg-slate-700 text-white" step="any" required value="1">
                </div>
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="buyPrice">Buy Price</label>
                    <input type="number" id="buyPrice" class="w-full p-2 rounded bg-slate-700 text-white" step="any" required>
                </div>
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="buyDate">Buy Date</label>
                    <input type="date" id="buyDate" class="w-full p-2 rounded bg-slate-700 text-white" required>
                </div>
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="beta">Beta</label>
                    <input type="number" id="beta" class="w-full p-2 rounded bg-slate-700 text-white" step="any">
                </div>
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="delta">Delta</label>
                    <input type="number" id="delta" class="w-full p-2 rounded bg-slate-700 text-white" step="any">
                </div>
                <div>
                    <label class="block text-sm text-gray-300 mb-1" for="notes">Notes</label>
                    <textarea id="notes" class="w-full p-2 rounded bg-slate-700 text-white"></textarea>
                </div>
                <div class="flex justify-end gap-2 mt-4">
                    <button type="button" id="cancelModalBtn" class="py-2 px-4 rounded bg-gray-600 text-white hover:bg-gray-500">Cancel</button>
                    <button type="submit" class="py-2 px-4 rounded bg-blue-600 text-white hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>
    <!-- Portfolio Cash Modal (hidden by default) -->
    <div id="cashModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 hidden">
        <div class="bg-slate-800 rounded-lg shadow-lg w-full max-w-md p-6">
            <h3 class="text-xl font-bold text-white mb-4">Portfolio Settings</h3>
            <form id="cashForm" class="space-y-4">
                <div>
                    <label for="cash" class="block text-sm text-gray-300 font-semibold mb-2">Total Portfolio Cash ($):</label>
                    <input type="text" id="cash" class="p-2 rounded bg-slate-700 text-white w-full" step="1" min="0" inputmode="numeric" autocomplete="off">
                </div>
                <div class="flex justify-end gap-2 mt-4">
                    <button type="button" id="cancelCashModalBtn" class="py-2 px-4 rounded bg-gray-600 text-white hover:bg-gray-500">Cancel</button>
                    <button type="submit" class="py-2 px-4 rounded bg-blue-600 text-white hover:bg-blue-700">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
#symbol {
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
#symbolDropdown {
  position: relative;
  z-index: 50;
}
#symbolDropdown > div {
  background: #1e293b;
  border: 1px solid #334155;
  border-top: none;
  border-radius: 0 0 0.5rem 0.5rem;
  box-shadow: 0 4px 24px 0 rgba(0,0,0,0.25);
  margin-top: 0;
  width: 100%;
  max-height: 14rem;
  overflow-y: auto;
}
#symbolDropdown .cursor-pointer {
  font-size: 1rem;
  color: #e5e7eb;
  padding: 0.5em 1em;
  background: none;
  transition: background 0.15s;
}
#symbolDropdown .hover\:bg-blue-700:hover, #symbolDropdown .bg-blue-700 {
  background: #1d4ed8 !important;
  color: #fff !important;
}
#symbolDropdown .font-semibold {
  font-weight: 600;
}
#symbolDropdown .text-xs {
  font-size: 0.8em;
}
/* Style datalist dropdown for symbol */
input[list="symbolOptions"]::-webkit-calendar-picker-indicator {
  display: none;
}
datalist#symbolOptions option {
  font-size: 1rem;
  color: #222;
  background: #fff;
  padding: 0.5em 1em;
}
input[list="symbolOptions"] {
  width: 100%;
  box-sizing: border-box;
}
</style>
<!-- Removed JS that formats cash input with commas. Input will now accept only plain whole numbers. --> 